<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atomic Builder Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1a1a1a;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e7ff;
        }
        ::-webkit-scrollbar-thumb {
            background: #5cadff;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #246db5;
        }
        /* Custom slider styles */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e0e7ff;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type=range]:hover {
            opacity: 1;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #246db5;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #ffffff;
        }
        input[type=range]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #246db5;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #ffffff;
        }
        .element-card.active {
            border-color: #246db5;
            background-color: #e0f2fe;
            transform: scale(1.05);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #246db5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -20px;
            margin-left: -20px;
            display: none; /* Initially hidden */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="min-h-screen w-full flex flex-col lg:flex-row bg-white">
        
        <!-- Left Column: Controls -->
        <div id="controls" class="w-full lg:w-1/3 xl:w-1/4 p-6 bg-gray-50 border-r border-gray-200 flex flex-col space-y-6 overflow-y-auto">
            <header>
                <h1 class="text-2xl font-bold text-[#246db5]">Atomic Builder Challenge</h1>
                <p class="text-sm text-gray-500">Select an element or use the sliders to build your own atom.</p>
            </header>

            <!-- Element Selection -->
            <div class="space-y-2">
                <h2 class="text-lg font-semibold text-gray-700">Choose an Element</h2>
                <div id="element-selector" class="grid grid-cols-2 gap-4">
                    <!-- Element cards will be generated by JS -->
                </div>
            </div>

            <!-- Element Info -->
            <div id="element-info-card" class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 space-y-3">
                <div class="flex items-center justify-between">
                    <h2 id="element-name" class="text-xl font-bold text-gray-800">Hydrogen</h2>
                    <div id="element-symbol" class="text-4xl font-bold text-[#246db5] bg-blue-100 w-16 h-16 flex items-center justify-center rounded-lg">H</div>
                </div>
                <div class="text-sm text-gray-600 space-y-1">
                    <p><strong>Atomic Number:</strong> <span id="atomic-number">1</span></p>
                    <p><strong>Electron Config:</strong> <span id="electron-config">1s¹</span></p>
                </div>
            </div>

            <!-- Sliders -->
            <div class="space-y-4 pt-4">
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <label for="protons-slider" class="font-medium text-gray-700">Protons</label>
                        <span id="protons-value" class="text-lg font-semibold text-[#246db5] bg-blue-100 px-3 py-1 rounded-md">1</span>
                    </div>
                    <input id="protons-slider" type="range" min="1" max="10" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <label for="electrons-slider" class="font-medium text-gray-700">Electrons</label>
                        <span id="electrons-value" class="text-lg font-semibold text-[#5cadff] bg-sky-100 px-3 py-1 rounded-md">1</span>
                    </div>
                    <input id="electrons-slider" type="range" min="0" max="18" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>

            <!-- Buttons -->
            <div class="pt-4 space-y-3 !mt-auto">
                <button id="instructor-btn" class="w-full bg-[#246db5] text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 transition-colors duration-300 shadow-md">
                    Ready for Instructor?
                </button>
                <button id="pdf-btn" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors duration-300 shadow-md">
                    Download as PDF
                </button>
            </div>
        </div>

        <!-- Right Column: Visualization -->
        <div id="visualization" class="w-full lg:w-2/3 xl:w-3/4 p-4 flex items-center justify-center bg-gray-100 relative">
            <div id="atomic-diagram-container" class="w-full h-full max-w-2xl max-h-2xl aspect-square">
                <!-- SVG will be generated by JS -->
            </div>
            <div id="pdf-loader" class="loader"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;

            // --- DATA ---
            const ELEMENTS = {
                1: { name: 'Hydrogen', symbol: 'H', atomicMass: 1, config: '1s¹' },
                2: { name: 'Helium', symbol: 'He', atomicMass: 4, config: '1s²' },
                6: { name: 'Carbon', symbol: 'C', atomicMass: 12, config: '1s² 2s² 2p²' },
                7: { name: 'Nitrogen', symbol: 'N', atomicMass: 14, config: '1s² 2s² 2p³' },
            };
            const UNKNOWN_ELEMENT = { name: 'Unknown Element', symbol: '?', atomicMass: 0, config: 'N/A' };

            // --- STATE ---
            let state = {
                protons: 1,
                electrons: 1,
            };

            // --- DOM ELEMENTS ---
            const elementSelector = document.getElementById('element-selector');
            const elementName = document.getElementById('element-name');
            const elementSymbol = document.getElementById('element-symbol');
            const atomicNumber = document.getElementById('atomic-number');
            const electronConfig = document.getElementById('electron-config');
            const protonsSlider = document.getElementById('protons-slider');
            const electronsSlider = document.getElementById('electrons-slider');
            const protonsValue = document.getElementById('protons-value');
            const electronsValue = document.getElementById('electrons-value');
            const diagramContainer = document.getElementById('atomic-diagram-container');
            const downloadPdfBtn = document.getElementById('pdf-btn');
            const pdfLoader = document.getElementById('pdf-loader');

            // --- FUNCTIONS ---

            function renderElementCards() {
                elementSelector.innerHTML = '';
                Object.entries(ELEMENTS).forEach(([num, el]) => {
                    const card = document.createElement('div');
                    card.className = 'element-card p-4 bg-white rounded-lg shadow-sm border-2 border-transparent cursor-pointer hover:border-[#5cadff] transition-all duration-300';
                    card.dataset.atomicNumber = num;
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <span class="text-2xl font-bold text-gray-800">${el.symbol}</span>
                            <span class="text-sm font-semibold text-gray-500">${num}</span>
                        </div>
                        <p class="text-xs text-gray-600 mt-1">${el.name}</p>
                    `;
                    card.addEventListener('click', () => handleElementSelect(parseInt(num)));
                    elementSelector.appendChild(card);
                });
            }

            function handleElementSelect(num) {
                const selectedElement = ELEMENTS[num];
                if (selectedElement) {
                    state.protons = num;
                    state.electrons = num;
                    updateApp();
                }
            }

            function handleProtonChange(e) {
                state.protons = parseInt(e.target.value);
                const currentElement = ELEMENTS[state.protons];
                if (currentElement) {
                    state.electrons = state.protons;
                }
                updateApp();
            }

            function handleElectronChange(e) {
                state.electrons = parseInt(e.target.value);
                updateApp();
            }

            function updateApp() {
                const currentElement = ELEMENTS[state.protons] || UNKNOWN_ELEMENT;
                
                // Update Info Panel
                elementName.textContent = currentElement.name;
                elementSymbol.textContent = currentElement.symbol;
                atomicNumber.textContent = state.protons;
                electronConfig.textContent = currentElement.config;

                // Update Sliders & Values
                protonsSlider.value = state.protons;
                protonsValue.textContent = state.protons;
                electronsSlider.value = state.electrons;
                electronsValue.textContent = state.electrons;

                // Update Active Card
                document.querySelectorAll('.element-card').forEach(card => {
                    card.classList.toggle('active', parseInt(card.dataset.atomicNumber) === state.protons);
                });

                // Render Diagram
                renderAtomicDiagram(currentElement);
            }

            function renderAtomicDiagram(element) {
                diagramContainer.innerHTML = '';
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute('viewBox', '0 0 500 500');
                svg.setAttribute('class', 'w-full h-full');

                const centerX = 250;
                const centerY = 250;
                const nucleusRadius = Math.max(30, 5 * Math.cbrt(state.protons + (element.atomicMass - state.protons)));

                // Draw Nucleus
                const nucleus = document.createElementNS(svgNS, 'circle');
                nucleus.setAttribute('cx', centerX);
                nucleus.setAttribute('cy', centerY);
                nucleus.setAttribute('r', nucleusRadius);
                nucleus.setAttribute('fill', '#e0f2fe');
                nucleus.setAttribute('stroke', '#5cadff');
                nucleus.setAttribute('stroke-width', '3');
                svg.appendChild(nucleus);

                // Draw Protons & Neutrons
                const neutrons = element.atomicMass > 0 ? element.atomicMass - state.protons : 0;
                const particleRadius = 6;
                for (let i = 0; i < state.protons; i++) {
                    drawParticle(svg, centerX, centerY, nucleusRadius, particleRadius, '#246db5');
                }
                for (let i = 0; i < neutrons; i++) {
                    drawParticle(svg, centerX, centerY, nucleusRadius, particleRadius, '#a0aec0');
                }

                // Draw Shells and Electrons
                const shellRadii = [100, 160, 220];
                const shellCapacities = [2, 8, 8];
                let electronsToPlace = state.electrons;

                for (let i = 0; i < shellRadii.length && electronsToPlace > 0; i++) {
                    const shellRadius = shellRadii[i];
                    const capacity = shellCapacities[i];
                    const electronsInShell = Math.min(electronsToPlace, capacity);

                    if (electronsInShell > 0) {
                        // Draw shell path
                        const shell = document.createElementNS(svgNS, 'circle');
                        shell.setAttribute('cx', centerX);
                        shell.setAttribute('cy', centerY);
                        shell.setAttribute('r', shellRadius);
                        shell.setAttribute('fill', 'none');
                        shell.setAttribute('stroke', '#cbd5e1');
                        shell.setAttribute('stroke-width', '1.5');
                        shell.setAttribute('stroke-dasharray', '4 4');
                        svg.appendChild(shell);

                        // Draw electrons on shell
                        for (let j = 0; j < electronsInShell; j++) {
                            const angle = (2 * Math.PI / electronsInShell) * j;
                            const ex = centerX + shellRadius * Math.cos(angle);
                            const ey = centerY + shellRadius * Math.sin(angle);
                            
                            const electron = document.createElementNS(svgNS, 'circle');
                            electron.setAttribute('cx', ex);
                            electron.setAttribute('cy', ey);
                            electron.setAttribute('r', 8);
                            electron.setAttribute('fill', '#5cadff');
                            electron.setAttribute('stroke', '#ffffff');
                            electron.setAttribute('stroke-width', '2');
                            svg.appendChild(electron);
                        }
                    }
                    electronsToPlace -= electronsInShell;
                }

                diagramContainer.appendChild(svg);
            }

            function drawParticle(svg, cx, cy, nucleusR, particleR, color) {
                const svgNS = "http://www.w3.org/2000/svg";
                const r = (nucleusR - particleR) * Math.sqrt(Math.random());
                const theta = Math.random() * 2 * Math.PI;
                const px = cx + r * Math.cos(theta);
                const py = cy + r * Math.sin(theta);

                const particle = document.createElementNS(svgNS, 'circle');
                particle.setAttribute('cx', px);
                particle.setAttribute('cy', py);
                particle.setAttribute('r', particleR);
                particle.setAttribute('fill', color);
                svg.appendChild(particle);
            }

            async function handleDownloadPDF() {
                pdfLoader.style.display = 'block';
                downloadPdfBtn.disabled = true;
                downloadPdfBtn.classList.add('opacity-50', 'cursor-not-allowed');

                try {
                    const canvas = await html2canvas(diagramContainer, {
                        backgroundColor: '#f1f5f9', // Match the bg color
                        scale: 2 // Higher resolution
                    });
                    const imgData = canvas.toDataURL('image/png');
                    
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'px',
                        format: [canvas.width, canvas.height]
                    });

                    const currentElement = ELEMENTS[state.protons] || UNKNOWN_ELEMENT;
                    const title = `Atomic Diagram: ${currentElement.name}`;
                    const details = `Protons: ${state.protons}, Electrons: ${state.electrons}, Neutrons: ${currentElement.atomicMass - state.protons}`;

                    pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
                    pdf.setFontSize(16);
                    pdf.setTextColor('#1a1a1a');
                    pdf.text(title, 20, 20);
                    pdf.setFontSize(12);
                    pdf.text(details, 20, 35);

                    pdf.save(`atomic-diagram-${currentElement.symbol || 'custom'}.pdf`);
                } catch (error) {
                    console.error("Failed to generate PDF:", error);
                    alert("Sorry, there was an error creating the PDF. Please try again.");
                } finally {
                    pdfLoader.style.display = 'none';
                    downloadPdfBtn.disabled = false;
                    downloadPdfBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            // --- INITIALIZATION ---
            function init() {
                renderElementCards();
                protonsSlider.addEventListener('input', handleProtonChange);
                electronsSlider.addEventListener('input', handleElectronChange);
                downloadPdfBtn.addEventListener('click', handleDownloadPDF);
                updateApp();
            }

            init();
        });
    </script>
</body>
</html>
